# ğŸ—ï¸ User Management System - Architecture Overview

## System Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     TicketMail Application                       â”‚
â”‚                     (User Management System)                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        FRONTEND LAYER                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   Users Tab     â”‚  â”‚ Companies Tab   â”‚  â”‚ Activity Log    â”‚ â”‚
â”‚  â”‚                 â”‚  â”‚                 â”‚  â”‚                 â”‚ â”‚
â”‚  â”‚ â€¢ User Table    â”‚  â”‚ â€¢ Company Cards â”‚  â”‚ â€¢ Activity List â”‚ â”‚
â”‚  â”‚ â€¢ Search/Filter â”‚  â”‚ â€¢ Statistics    â”‚  â”‚ â€¢ Filters       â”‚ â”‚
â”‚  â”‚ â€¢ Create/Edit   â”‚  â”‚ â€¢ Create/Edit   â”‚  â”‚ â€¢ Date Range    â”‚ â”‚
â”‚  â”‚ â€¢ Export CSV    â”‚  â”‚ â€¢ Export CSV    â”‚  â”‚ â€¢ Export        â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚                Modal Dialogs                                 â”‚â”‚
â”‚  â”‚  â€¢ User Create/Edit Modal                                    â”‚â”‚
â”‚  â”‚  â€¢ Company Create/Edit Modal                                 â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                   â”‚
â”‚  Assets:                                                          â”‚
â”‚  â€¢ user-management.js   (UI Logic, API Calls, Event Handlers)   â”‚
â”‚  â€¢ user-management.css  (Styles, Animations, Responsive Design) â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†•ï¸ REST API
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         API LAYER                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚  User Management APIs:                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ POST  /api/create-user      â†’ Create new user            â”‚   â”‚
â”‚  â”‚ POST  /api/update-user      â†’ Update user info           â”‚   â”‚
â”‚  â”‚ POST  /api/delete-user      â†’ Delete user                â”‚   â”‚
â”‚  â”‚ GET   /api/list-users       â†’ Get all users with company â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                   â”‚
â”‚  Company Management APIs:                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ POST  /api/companies-create â†’ Create new company         â”‚   â”‚
â”‚  â”‚ PUT   /api/companies-update â†’ Update company info        â”‚   â”‚
â”‚  â”‚ GET   /api/companies-list   â†’ Get all companies          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                   â”‚
â”‚  Analytics APIs (Enhanced):                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ GET   /api/get-analytics    â†’ Company & agent metrics    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                   â”‚
â”‚  Authentication:                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ lib/auth.js â†’ validateSession, createUser (enhanced)      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†•ï¸ SQL Queries
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       DATABASE LAYER                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                    companies Table                       â”‚    â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚ â€¢ id (PK)              â€¢ address                         â”‚    â”‚
â”‚  â”‚ â€¢ name (UNIQUE)        â€¢ industry                        â”‚    â”‚
â”‚  â”‚ â€¢ domain               â€¢ company_size                    â”‚    â”‚
â”‚  â”‚ â€¢ phone                â€¢ notes                           â”‚    â”‚
â”‚  â”‚ â€¢ is_active            â€¢ created_at, updated_at          â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                     users Table (Enhanced)               â”‚    â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚ â€¢ id (PK)              â€¢ role                            â”‚    â”‚
â”‚  â”‚ â€¢ email                â€¢ is_active                       â”‚    â”‚
â”‚  â”‚ â€¢ password_hash        â€¢ created_at                      â”‚    â”‚
â”‚  â”‚ â€¢ full_name            â€¢ last_login                      â”‚    â”‚
â”‚  â”‚ â€¢ company_id (FK) â† NEW!                                 â”‚    â”‚
â”‚  â”‚ â€¢ department      â† NEW!                                 â”‚    â”‚
â”‚  â”‚ â€¢ job_title       â† NEW!                                 â”‚    â”‚
â”‚  â”‚ â€¢ phone           â† NEW!                                 â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                   tickets Table (Enhanced)               â”‚    â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚ â€¢ id (PK)              â€¢ status                          â”‚    â”‚
â”‚  â”‚ â€¢ subject              â€¢ priority                        â”‚    â”‚
â”‚  â”‚ â€¢ from_email           â€¢ category                        â”‚    â”‚
â”‚  â”‚ â€¢ body_text            â€¢ created_at                      â”‚    â”‚
â”‚  â”‚ â€¢ company_id (FK) â† NEW! (Links to companies)            â”‚    â”‚
â”‚  â”‚ â€¢ assigned_to (FK)â† NEW! (Links to users - agent)        â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                   â”‚
â”‚  Indexes for Performance:                                         â”‚
â”‚  â€¢ idx_users_company     (users.company_id)                      â”‚
â”‚  â€¢ idx_tickets_company   (tickets.company_id)                    â”‚
â”‚  â€¢ idx_tickets_assigned  (tickets.assigned_to)                   â”‚
â”‚  â€¢ idx_companies_active  (companies.is_active)                   â”‚
â”‚  â€¢ idx_companies_name    (companies.name)                        â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Data Flow Diagrams

### Creating a User with Company

```
User Interface                 API                    Database
     â”‚                          â”‚                         â”‚
     â”‚  1. Click "Add User"     â”‚                         â”‚
     â”‚                          â”‚                         â”‚
     â”‚  2. Fill Form:           â”‚                         â”‚
     â”‚     - Name, Email        â”‚                         â”‚
     â”‚     - Role, Company      â”‚                         â”‚
     â”‚     - Department, etc.   â”‚                         â”‚
     â”‚                          â”‚                         â”‚
     â”‚  3. Submit Form          â”‚                         â”‚
     â”œâ”€â”€â”€â”€â”€POST /create-userâ”€â”€â”€â”€â–º                         â”‚
     â”‚     {email, fullName,    â”‚                         â”‚
     â”‚      role, companyId,    â”‚                         â”‚
     â”‚      department...}      â”‚                         â”‚
     â”‚                          â”‚                         â”‚
     â”‚                          â”‚  4. Validate Data       â”‚
     â”‚                          â”‚                         â”‚
     â”‚                          â”‚  5. Hash Password       â”‚
     â”‚                          â”‚                         â”‚
     â”‚                          â”œâ”€â”€INSERT INTO usersâ”€â”€â”€â”€â”€â”€â–º
     â”‚                          â”‚  (email, password_hash, â”‚
     â”‚                          â”‚   full_name, role,      â”‚
     â”‚                          â”‚   company_id,           â”‚
     â”‚                          â”‚   department...)        â”‚
     â”‚                          â”‚                         â”‚
     â”‚                          â”‚â—„â”€â”€â”€â”€User Createdâ”€â”€â”€â”€â”€â”€â”€â”€â”¤
     â”‚                          â”‚  {id, email, ...}       â”‚
     â”‚                          â”‚                         â”‚
     â”‚â—„â”€â”€â”€{success: true}â”€â”€â”€â”€â”€â”€â”€â”¤                         â”‚
     â”‚    {user: {...}}         â”‚                         â”‚
     â”‚                          â”‚                         â”‚
     â”‚  6. Show Success Toast   â”‚                         â”‚
     â”‚                          â”‚                         â”‚
     â”‚  7. Refresh User List    â”‚                         â”‚
     â”‚                          â”‚                         â”‚
```

### Loading Users with Company Data

```
User Interface                 API                    Database
     â”‚                          â”‚                         â”‚
     â”‚  1. Load Users Page      â”‚                         â”‚
     â”œâ”€â”€â”€â”€â”€GET /list-usersâ”€â”€â”€â”€â”€â”€â–º                         â”‚
     â”‚                          â”‚                         â”‚
     â”‚                          â”‚  2. Validate Session    â”‚
     â”‚                          â”‚                         â”‚
     â”‚                          â”œâ”€â”€SELECT users JOINâ”€â”€â”€â”€â”€â”€â–º
     â”‚                          â”‚  companies ON           â”‚
     â”‚                          â”‚  users.company_id =     â”‚
     â”‚                          â”‚  companies.id           â”‚
     â”‚                          â”‚                         â”‚
     â”‚                          â”‚â—„â”€â”€â”€â”€Result Setâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
     â”‚                          â”‚  [{id, email, fullName, â”‚
     â”‚                          â”‚    companyName,         â”‚
     â”‚                          â”‚    companyDomain...}]   â”‚
     â”‚                          â”‚                         â”‚
     â”‚â—„â”€â”€â”€{success: true}â”€â”€â”€â”€â”€â”€â”€â”¤                         â”‚
     â”‚    {users: [...],        â”‚                         â”‚
     â”‚     roles: {...}}        â”‚                         â”‚
     â”‚                          â”‚                         â”‚
     â”‚  3. Render User Table    â”‚                         â”‚
     â”‚     with Company Info    â”‚                         â”‚
     â”‚                          â”‚                         â”‚
```

### Company Analytics

```
Analytics Page                 API                    Database
     â”‚                          â”‚                         â”‚
     â”‚  1. Load Analytics       â”‚                         â”‚
     â”œâ”€â”€â”€GET /get-analyticsâ”€â”€â”€â”€â”€â–º                         â”‚
     â”‚                          â”‚                         â”‚
     â”‚                          â”œâ”€â”€Complex Queriesâ”€â”€â”€â”€â”€â”€â”€â”€â–º
     â”‚                          â”‚                         â”‚
     â”‚                          â”‚  A. Tickets by Company: â”‚
     â”‚                          â”‚  SELECT c.name,         â”‚
     â”‚                          â”‚    COUNT(t.id),         â”‚
     â”‚                          â”‚    AVG(resolution...)   â”‚
     â”‚                          â”‚  FROM companies c       â”‚
     â”‚                          â”‚  JOIN tickets t...      â”‚
     â”‚                          â”‚                         â”‚
     â”‚                          â”‚  B. Agent Performance:  â”‚
     â”‚                          â”‚  SELECT u.full_name,    â”‚
     â”‚                          â”‚    COUNT(t.id) as       â”‚
     â”‚                          â”‚      assigned_tickets   â”‚
     â”‚                          â”‚  FROM users u JOIN...   â”‚
     â”‚                          â”‚                         â”‚
     â”‚                          â”‚â—„â”€â”€â”€â”€Resultsâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
     â”‚                          â”‚                         â”‚
     â”‚â—„â”€â”€â”€{analytics: {...}}â”€â”€â”€â”€â”¤                         â”‚
     â”‚    {companies: {...},    â”‚                         â”‚
     â”‚     agents: {...}}       â”‚                         â”‚
     â”‚                          â”‚                         â”‚
     â”‚  2. Render Charts with   â”‚                         â”‚
     â”‚     Company Data         â”‚                         â”‚
     â”‚                          â”‚                         â”‚
```

## Component Relationships

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    User Management                       â”‚
â”‚                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                        â”‚
â”‚  â”‚   Users      â”‚â—„â”€â”€â”€â”                                   â”‚
â”‚  â”‚              â”‚    â”‚                                   â”‚
â”‚  â”‚ â€¢ Create     â”‚    â”‚                                   â”‚
â”‚  â”‚ â€¢ Edit       â”‚    â”‚  Belongs To                       â”‚
â”‚  â”‚ â€¢ Delete     â”‚    â”‚                                   â”‚
â”‚  â”‚ â€¢ Filter     â”‚    â”‚                                   â”‚
â”‚  â”‚ â€¢ Export     â”‚    â”‚                                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚                                   â”‚
â”‚         â”‚            â”‚                                   â”‚
â”‚         â”‚ Links      â”‚                                   â”‚
â”‚         â”‚ To         â”‚                                   â”‚
â”‚         â†“            â”‚                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚                                    â”‚
â”‚  â”‚  Companies   â”‚â”€â”€â”€â”˜                                    â”‚
â”‚  â”‚              â”‚                                        â”‚
â”‚  â”‚ â€¢ Create     â”‚                                        â”‚
â”‚  â”‚ â€¢ Edit       â”‚                                        â”‚
â”‚  â”‚ â€¢ View Stats â”‚                                        â”‚
â”‚  â”‚ â€¢ Export     â”‚                                        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                        â”‚
â”‚         â”‚                                                â”‚
â”‚         â”‚ Has Many                                       â”‚
â”‚         â†“                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                        â”‚
â”‚  â”‚   Tickets    â”‚                                        â”‚
â”‚  â”‚              â”‚                                        â”‚
â”‚  â”‚ â€¢ Linked to  â”‚â—„â”€â”€â”€â”€â”€â”€â”€ Assigned To                   â”‚
â”‚  â”‚   Company    â”‚                                        â”‚
â”‚  â”‚ â€¢ Assigned   â”‚                                        â”‚
â”‚  â”‚   to Agent   â”‚                                        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                        â”‚
â”‚         â”‚                                                â”‚
â”‚         â”‚ Analyzed In                                    â”‚
â”‚         â†“                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                        â”‚
â”‚  â”‚  Analytics   â”‚                                        â”‚
â”‚  â”‚              â”‚                                        â”‚
â”‚  â”‚ â€¢ Company    â”‚                                        â”‚
â”‚  â”‚   Performanceâ”‚                                        â”‚
â”‚  â”‚ â€¢ Agent      â”‚                                        â”‚
â”‚  â”‚   Workload   â”‚                                        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                        â”‚
â”‚                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Security & Permissions Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    User     â”‚
â”‚   Logs In   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Authenticate    â”‚
â”‚ Get Role        â”‚
â”‚ Generate Token  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Role-Based Access Control        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚  Admin   â”‚  â”‚  Agent   â”‚  â”‚Customerâ”‚â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜â”‚
â”‚       â”‚             â”‚             â”‚     â”‚
â”‚       â”‚             â”‚             â”‚     â”‚
â”‚  âœ… Full Access  âœ… View Users âŒ No Accessâ”‚
â”‚  âœ… Create All  âœ… View Cos.  âŒ To User   â”‚
â”‚  âœ… Edit All    âŒ No Create  âŒ Mgmt      â”‚
â”‚  âœ… Delete      âŒ No Edit    âœ… Own       â”‚
â”‚  âœ… Export      âœ… Export     âœ… Tickets   â”‚
â”‚                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ API Validates   â”‚
â”‚ Session Token & â”‚
â”‚ Checks Role     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## File Dependencies

```
index.html
  â”‚
  â”œâ”€â”€ Links to: assets/user-management.css
  â”‚                â””â”€â”€ Styles for: Modals, Tables, Cards, Buttons
  â”‚
  â”œâ”€â”€ Links to: assets/user-management.js
  â”‚                â””â”€â”€ Functions: switchUserTab(), openUserModal(),
  â”‚                               saveUser(), loadCompanies(), etc.
  â”‚
  â””â”€â”€ Contains: User Management HTML
                  â”œâ”€â”€ Users Tab
                  â”œâ”€â”€ Companies Tab
                  â”œâ”€â”€ Activity Log Tab
                  â”œâ”€â”€ User Modal
                  â””â”€â”€ Company Modal

Netlify Functions:
  â”‚
  â”œâ”€â”€ companies-create.js  â†’ Creates companies
  â”œâ”€â”€ companies-list.js    â†’ Lists companies with stats
  â”œâ”€â”€ companies-update.js  â†’ Updates companies
  â”œâ”€â”€ create-user.js       â†’ Creates users (enhanced)
  â”œâ”€â”€ update-user.js       â†’ Updates users (enhanced)
  â”œâ”€â”€ list-users.js        â†’ Lists users with companies
  â””â”€â”€ get-analytics.js     â†’ Analytics (enhanced)
           â”‚
           â””â”€â”€ Uses: lib/auth.js, lib/database.js

Database:
  â”‚
  â””â”€â”€ local-database.sqlite (or production DB)
           â”œâ”€â”€ companies table
           â”œâ”€â”€ users table (enhanced)
           â”œâ”€â”€ tickets table (enhanced)
           â””â”€â”€ Other tables...
```

## Workflow: Complete User Journey

```
1. Admin logs in
   â””â”€â–º Authenticated with session token
        â””â”€â–º Role: admin

2. Navigates to User Management
   â””â”€â–º Clicks "User Management" in sidebar
        â””â”€â–º Page loads with Users tab active

3. Creates a Company
   â””â”€â–º Clicks "Companies" tab
        â””â”€â–º Clicks "Add New Company"
             â””â”€â–º Fills form: Name, Domain, Industry, Size
                  â””â”€â–º Clicks "Save Company"
                       â””â”€â–º POST /companies-create
                            â””â”€â–º Company created in DB
                                 â””â”€â–º Success toast shown
                                      â””â”€â–º Company card appears

4. Creates a User in That Company
   â””â”€â–º Clicks "Users" tab
        â””â”€â–º Clicks "Add New User"
             â””â”€â–º Fills form: Name, Email, Role, Company (dropdown)
                  â””â”€â–º Adds Department, Job Title
                       â””â”€â–º Sets Password
                            â””â”€â–º Clicks "Save User"
                                 â””â”€â–º POST /create-user
                                      â””â”€â–º User created with company_id
                                           â””â”€â–º Success toast shown
                                                â””â”€â–º User row appears in table

5. Assigns Ticket to Company
   â””â”€â–º Creates or edits a ticket
        â””â”€â–º Selects company from dropdown
             â””â”€â–º Ticket.company_id = company.id

6. Views Analytics
   â””â”€â–º Navigates to Analytics page
        â””â”€â–º Sees "Top Companies by Tickets"
             â””â”€â–º Company's ticket count displayed
                  â””â”€â–º Resolution time metrics shown

7. Exports Data for Reporting
   â””â”€â–º Returns to User Management
        â””â”€â–º Clicks "Export Users"
             â””â”€â–º CSV downloads with all user + company data
                  â””â”€â–º Opens in Excel/Google Sheets
```

## Performance Optimization Points

- **Indexes** on foreign keys (company_id, assigned_to)
- **JOIN queries** optimized with proper indexing
- **Cached company list** in frontend (loaded once)
- **Pagination** ready for large datasets
- **Lazy loading** for company cards
- **Debounced search** for filtering
- **Batch operations** for exports

## Scalability Considerations

- Database indexes ensure fast queries even with 10,000+ users
- Company dropdown cached to avoid repeated API calls
- Filtering happens client-side after initial load
- Export uses streaming for large datasets
- Analytics queries optimized with GROUP BY and indexes
- Can add pagination easily if needed

---

This architecture provides a solid foundation for enterprise-level user and company management while maintaining simplicity and ease of use.
